{"metadata":{"guid":"ff4cdaeb-246f-4408-b88d-4a6e8ed89948","url":"/v2/streaming_pipelines/ff4cdaeb-246f-4408-b88d-4a6e8ed89948","created_at":"2019-09-19T08:46:32Z","updated_at":"2019-09-20T08:15:48Z","revision":1568967348609},"entity":{"name":"Predictive analytics stream fLow","description":"","project_guid":"e396d5be-566e-4f1a-9a92-dde8cb99110a","graph":{"doc_type":"pipeline","version":"1.0","json_schema":"http://www.ibm.com/ibm/wdp/flow-v1.0/pipeline-flow-v1-schema.json","id":"","app_data":{"ui_data":{"name":"Predictive analytics stream fLow"}},"primary_pipeline":"primary-pipeline","pipelines":[{"id":"primary-pipeline","runtime":"streams","nodes":[{"id":"http_uos0pcjm4ml","type":"binding","op":"ibm.streams.sources.http","outputs":[{"id":"target","schema_ref":"schema0","links":[{"node_id_ref":"code_ml_h4n5ukv18cm","port_id_ref":"source"}]}],"parameters":{"url":"<Enter your API URL Here>","polling_interval":"1","format":"JSON","schema_mapping":[{"name":"ID","type":"double","preview_name":"statusCode","schema_column":{"name":"http_status_code","type":{"type":"double","spl_type":"float64"}},"path":"/ID"},{"name":"Age","type":"double","preview_name":"statusMessage","schema_column":{"name":"http_reason","type":{"type":"varchar","spl_type":"rstring"}},"path":"/Age"},{"name":"Experience","type":"double","preview_name":"headers","schema_column":{"name":"http_headers","type":{"type":"varchar","spl_type":"rstring"}},"path":"/Experience"},{"name":"Income","type":"double","preview_name":"body","schema_column":{"name":"http_body","type":{"type":"varchar","spl_type":"rstring"}},"path":"/Income"},{"name":"ZIPCode","type":"double","length":0,"target_elem_name":"","path":"/ZIPCode"},{"name":"Family","type":"double","length":0,"target_elem_name":"","path":"/Family"},{"name":"CCAvg","type":"double","length":0,"target_elem_name":"","path":"/CCAvg"},{"name":"Education","type":"double","length":0,"target_elem_name":"","path":"/Education"},{"name":"Mortgage","type":"double","length":0,"target_elem_name":"","path":"/Mortgage"},{"name":"SecuritiesAccount","type":"double","length":0,"target_elem_name":"","path":"/SecuritiesAccount"},{"name":"CDAccount","type":"double","length":0,"target_elem_name":"","path":"/CDAccount"},{"name":"Online","type":"double","length":0,"target_elem_name":"","path":"/Online"},{"name":"CreditCard","type":"double","length":0,"target_elem_name":"","path":"/CreditCard"}]},"app_data":{"ui_data":{"label":"Simulating Real-time Data","x_pos":50,"y_pos":90}}},{"id":"code_ml_h4n5ukv18cm","type":"execution_node","op":"ibm.streams.operations.code-ml","outputs":[{"id":"target","schema_ref":"schema1","links":[{"node_id_ref":"debug_v18wyvp356","port_id_ref":"source"}]}],"parameters":{"service_ref":"a47242c7-6794-4ad3-9ede-309ef148b1c0","model_ref":"25dc3026-ddd3-49fe-b977-1db459bcccc7","code":"#\n# YOU MUST EDIT THE SCHEMA and add all attributes that you are returning as output.\n#\n# Preinstalled Python packages can be viewed from the Settings pane.\n# In the Settings pane you can also install additional Python packages.\n\nimport sys\nimport logging\nimport pickle\nimport pandas as pd\n\n# Use this logger for tracing or debugging your code:\nlogger = logging.getLogger(__name__)\n# Example:\n#     logger.info('Got to step 2...')\n\n# init() function will be called once on flow initialization\n# @state a Python dictionary object for keeping state. The state object is passed to the process function\ndef init(state):\n    # do something once on flow initialization and save in the state object\n    pass\n\n\n# process() function will be invoked on every event tuple\n# @event a Python dictionary object representing the input event tuple as defined by the input schema\n# @state a Python dictionary object for keeping state over subsequent function calls\n# return must be a Python dictionary object. It will be the output of this operator.\n#        Returning None results in not submitting an output tuple for this invocation.\n# You must declare all output attributes in the Edit Schema window.\ndef process(event, state):\n    id = event['ID']\n    age = event['Age']\n    experience = event['Experience']\n    income = event['Income']\n    zipcode = event['ZIPCode']\n    family = event['Family']\n    ccavg = event['CCAvg']\n    education = event['Education']\n    motgage = event['Mortgage']\n    securitiesaccount = event['SecuritiesAccount']\n    cdaccount = event['CDAccount']\n    online = event['Online']\n    creditcard = event['CreditCard']\n    \n#   mytupple = (id,age,experience,income,zipcode,family,ccavg,education,motgage,securitiesaccount,cdaccount,online,creditcard)\n    mylist = []\n    mylist.append([age,income,zipcode,family,ccavg,education,motgage,securitiesaccount,cdaccount,online,creditcard])\n\n    test_set = pd.DataFrame(mylist, columns=['Age', 'Income', 'ZIPCode', 'Family', 'CCAvg', 'Education', 'Mortgage', 'SecuritiesAccount', 'CDAccount', 'Online', 'CreditCard'])\n\n# Invoke the model-specific scoring function\n    model = state['model']\n    event['Prediction'] = model.predict(test_set)\n    \n    return event\n\n# Ensure that the Python packages used in this streams flow are compatible\n# with the packages that you used to create the model. (Click Settings > Runtime).\ndef load_model(state, model):\n\tstate['model'] = model","schema_mapping":[{"name":"ID","type":"double","length":0,"source_elem_name":""},{"name":"Prediction","type":"double","length":0,"source_elem_name":"","target_elem_name":""},{"name":"Income","type":"double","length":0,"source_elem_name":"","target_elem_name":""},{"name":"CCAvg","type":"double","length":0,"source_elem_name":"","target_elem_name":""},{"name":"Mortgage","type":"double","length":0,"source_elem_name":"","target_elem_name":""},{"name":"SecuritiesAccount","type":"double","length":0,"source_elem_name":"","target_elem_name":""}]},"app_data":{"ui_data":{"label":"Python Model","x_pos":300,"y_pos":90}}},{"id":"debug_v18wyvp356","type":"binding","op":"ibm.streams.targets.debug","parameters":{},"app_data":{"ui_data":{"label":"Debug","x_pos":560,"y_pos":90}}}]}],"schemas":[{"id":"schema0","fields":[{"name":"ID","type":"double"},{"name":"Age","type":"double"},{"name":"Experience","type":"double"},{"name":"Income","type":"double"},{"name":"ZIPCode","type":"double"},{"name":"Family","type":"double"},{"name":"CCAvg","type":"double"},{"name":"Education","type":"double"},{"name":"Mortgage","type":"double"},{"name":"SecuritiesAccount","type":"double"},{"name":"CDAccount","type":"double"},{"name":"Online","type":"double"},{"name":"CreditCard","type":"double"}]},{"id":"schema1","fields":[{"name":"ID","type":"double"},{"name":"Prediction","type":"double"},{"name":"Income","type":"double"},{"name":"CCAvg","type":"double"},{"name":"Mortgage","type":"double"},{"name":"SecuritiesAccount","type":"double"}]}]},"engines":{"streams":{"instance_id":"3a3a7955-3d30-4efc-beff-7840b92b0074","userPythonPackages":["pandas == 0.25.1","numpy == 1.17.2","scikit-learn == 0.21.3"]}}}}